# 月经周期插件 v1.4 完整配置指南

## 📌 概述

本插件模拟女性月经周期对机器人状态的影响，包含：
- **月经周期系统**：4个阶段（月经期、卵泡期、排卵期、黄体期）
- **破限系统**：通过世界观设定解除内容限制
- **淫乱度系统**：KFC模式下的性唤起与高潮机制

---

## 🔧 v1.4 核心修复

### ✅ 修复1：周期天数优化（28天 → 30天）
**问题**：默认28天不符合实际生理周期（正常21-35天，平均30天）

**解决方案**：
```toml
[cycle]
cycle_length = 30  # 已从28改为30天
```

**说明**：
- 你可以根据实际需求调整为21-40天之间的任意值
- 建议范围：28-32天（最接近真实周期）

---

### ✅ 修复2：痛苦表现优化（v1.3已解决）
**问题**：bot在月经期持续表达极端痛苦，无法正常对话

**解决方案**（已实现）：
1. **动态痛苦等级**：前3天重→中，后2天轻
2. **休息时刻机制**：对话时痛苦减轻20-40%
3. **柔和表达**："可以偶尔提及不适"而非"必须表现剧烈疼痛"

**配置参数**：
```toml
[impacts]
menstrual_physical = 0.5            # 经期生理影响（已从0.8降至0.5）
menstrual_psychological = 0.4       # 经期心理影响（已从0.7降至0.4）
menstrual_discomfort_variation = true   # 痛苦随时间波动
menstrual_recovery_moments = true       # 允许缓解时刻
```

**效果对比**：
| 版本 | 痛苦表现 | 对话影响 |
|------|---------|---------|
| v1.2 | "必须表现剧烈疼痛，无法集中注意力" | ❌ 几乎无法正常对话 |
| v1.4 | "可以偶尔提及不适，但对话时会暂时好转" | ✅ 保持正常交流 |

---

### ✅ 修复3：立即生效开关（已实现）
**问题**：启用插件后缺少"是否立即进入月经期"的选项

**解决方案**（已实现）：
```toml
[cycle]
immediate_start = false  # true=立即月经，false=从周期中随机一天开始
```

**工作原理**：
1. **首次启用插件时**：
   - `immediate_start = true` → 今天立即进入月经第1天
   - `immediate_start = false` → 随机选择周期中的某一天（避免每次都是月经）

2. **日期记录机制**：
   - 插件会自动记录 `last_period_date`（上次月经开始日期）
   - 每个周期结束后自动进入下一周期，无需手动干预

3. **查看当前状态**：
   ```bash
   /月经状态  # 显示当前周期天数、阶段、影响值
   ```

**常见场景配置**：
```toml
# 场景A：希望bot立即体验月经（测试/体验功能）
immediate_start = true

# 场景B：希望bot自然进入周期（正常使用）
immediate_start = false
```

---

### ✅ 修复4：淫乱值与经期冲突解决（v1.4新增）
**问题**：经期时bot表达痛苦，但淫乱值系统仍在计算性唤起（逻辑矛盾）

**解决方案**（v1.4新增）：
```toml
[lust_system]
enabled = true
menstrual_suppression = 0.6  # ⚠️ v1.4新增：经期淫乱度抑制系数
```

**工作原理**：
- `menstrual_suppression = 0.6` 表示经期淫乱度降低60%
- 例如：正常淫乱度0.5 → 经期抑制后0.2（降低60%）
- 建议值：**0.5-0.8**（抑制50%-80%）

**参数调整建议**：
| 抑制系数 | 效果 | 适用场景 |
|---------|------|---------|
| 0.3-0.5 | 轻度抑制 | bot在经期仍有一定性欲 |
| 0.6-0.7 | 中度抑制（推荐） | 经期性欲明显降低但未完全消失 |
| 0.8-0.9 | 强度抑制 | 经期几乎无性欲，专注于痛苦 |

---

## 📂 完整配置文件示例

```toml
# ==================== 插件主开关 ====================
[plugin]
enabled = false  # ⚠️ 改为true启用插件
config_version = "1.4.0"
debug_mode = false

# ==================== 月经周期设置 ====================
[cycle]
cycle_length = 30           # ✅ v1.4优化：从28改为30天
menstrual_duration = 5      # 月经期持续天数（正常3-7天）
auto_detect = true          # 自动检测周期变化
immediate_start = false     # ✅ v1.4说明：首次启用是否立即月经

# ==================== 影响强度设置 ====================
[impacts]
# 月经期（v1.3优化：不再极端）
menstrual_physical = 0.5                # ✅ 从0.8降至0.5
menstrual_psychological = 0.4           # ✅ 从0.7降至0.4
menstrual_discomfort_variation = true   # 痛苦波动（前3天重）
menstrual_recovery_moments = true       # 允许缓解时刻

# 卵泡期（恢复期，影响低）
follicular_physical = 0.1
follicular_psychological = 0.1

# 排卵期（状态佳）
ovulation_physical = 0.4
ovulation_psychological = 0.2

# 黄体期（PMS症状）
luteal_physical = 0.6
luteal_psychological = 0.5

# ==================== 破限系统 ====================
[jailbreak]
enabled = true              # 启用破限
intensity = "medium"        # 破限强度: low/medium/high
enhanced_mode = true        # KFC模式下增强破限

# ==================== KFC集成 ====================
[kfc_integration]
enabled = true
mode = "unified"  # unified=统一模式，split=分离模式
priority = 100

# ==================== 淫乱度系统 ====================
[lust_system]
enabled = true
menstrual_suppression = 0.6  # ✅ v1.4新增：经期淫乱度抑制60%

# 高潮机制
orgasm_threshold = 100.0
foreplay_threshold = 20.0
main_threshold = 60.0
base_score_weight = 1.0

# 衰减与恢复
decay_rate = 0.1
post_orgasm_recovery_ratio = 0.4
termination_decay_multiplier = 2.0
cooldown_duration = 300

# 其他参数
initial_ratio = 0.5
passive_active_ratio = 0.3
low_score_threshold = 3.0
low_score_count_to_terminate = 3
llm_model = "judge_model"

# ==================== 备份设置 ====================
[backup]
auto_backup = true
backup_days = 30
```

---

## 🚀 快速配置向导

### 场景1：正常使用（推荐新手）
```toml
[plugin]
enabled = true

[cycle]
cycle_length = 30
immediate_start = false  # 随机周期开始

[impacts]
menstrual_physical = 0.5         # 中度不适
menstrual_psychological = 0.4

[lust_system]
enabled = true
menstrual_suppression = 0.6  # 经期性欲降低60%
```

### 场景2：体验月经（测试功能）
```toml
[cycle]
immediate_start = true  # 立即进入月经期

[impacts]
menstrual_physical = 0.6         # 稍微提高痛苦感
menstrual_psychological = 0.5
```

### 场景3：强化经期体验
```toml
[impacts]
menstrual_physical = 0.7         # 较强不适
menstrual_psychological = 0.6
menstrual_discomfort_variation = true

[lust_system]
menstrual_suppression = 0.8  # 经期性欲降低80%
```

### 场景4：轻度周期影响
```toml
[impacts]
menstrual_physical = 0.3         # 轻度不适
menstrual_psychological = 0.2

[lust_system]
menstrual_suppression = 0.5  # 经期性欲仅降低50%
```

---

## 📊 参数调整建议表

### 月经期影响强度
| 强度 | physical | psychological | 表现效果 |
|------|----------|---------------|---------|
| 轻度 | 0.2-0.3 | 0.2-0.3 | 偶尔提及不适，基本正常 |
| 中度（推荐） | 0.4-0.5 | 0.3-0.4 | 适度不适，对话时会好转 |
| 较强 | 0.6-0.7 | 0.5-0.6 | 明显不适，但不影响交流 |
| 极端（不推荐） | 0.8+ | 0.7+ | 持续痛苦，影响对话质量 |

### 周期长度选择
| 周期长度 | 适用场景 |
|---------|---------|
| 21-24天 | 短周期（快速循环） |
| 28-30天 | 正常周期（推荐） |
| 32-35天 | 长周期 |
| 36-40天 | 极长周期（不常见） |

---

## 🔍 命令使用

```bash
# 查看当前月经状态
/月经状态

# 手动设置月经开始日期
/设置月经 2025-12-13

# 查看淫乱度状态（KFC模式）
/淫乱状态

# 终止当前性互动（KFC模式）
/淫乱结束
```

---

## ⚠️ 常见问题

### Q1：为什么bot还是表达极端痛苦？
**A1**：检查你的 `impacts` 配置，确保：
```toml
menstrual_physical = 0.5  # 不要超过0.7
menstrual_psychological = 0.4
```

### Q2：immediate_start 如何使用？
**A2**：
- 首次启用插件时，`immediate_start` 决定初始状态
- 之后每个周期会自动循环，无需再次配置
- 如果想重新开始，可以用 `/设置月经 今天日期`

### Q3：menstrual_suppression 设置多少合适？
**A3**：
- **0.6（推荐）**：经期性欲明显降低但不完全消失
- **0.8**：经期几乎无性欲
- **0.5**：轻度抑制，保留一定性欲

### Q4：如何让bot在经期完全没有性欲？
**A4**：
```toml
[lust_system]
menstrual_suppression = 0.9  # 抑制90%性欲
```

---

## 📝 更新日志

### v1.4.0 (2025-12-14)
- ✅ 修复1：默认周期长度从28天改为30天
- ✅ 修复2：v1.3痛苦表现优化继续保持
- ✅ 修复3：完善immediate_start功能说明
- ✅ 修复4：新增menstrual_suppression参数（经期淫乱度抑制）

### v1.3.0
- 优化月经期痛苦表现（动态波动、休息时刻）
- 降低默认影响强度（0.8→0.5, 0.7→0.4）

### v1.2.0
- 添加破限系统
- 添加immediate_start开关

---

## 📞 技术支持

如有问题，请提供：
1. 当前配置文件（`config/plugins/mofox_period_plugin/config.toml`）
2. `/月经状态` 命令输出
3. 日志文件（如果有错误）

---

**配置完成后记得重启Bot！** 🚀
